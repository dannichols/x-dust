<!doctype html>
<html>
  <head>
    <title>x-dust.js Tests</title>
  </head>
  <body>
    <button id="run-tests" type="button">Run Tests</button>
    <script type="text/javascript" src="../src/x-dust-0.5.0.js"></script>
    <script type="text/javascript">
    (function(dust) {
      var UNDEFINED;
      function _print(v) {
        console.log(v);
      }
      function _test(name, code, model) {
        try {
            _print('------VALUE------');
            _print(code);
            _print('------PARSED------');
            _print(dust.compile(code, name));//.toJSON());
            //_print('------COMPILED-----');
            //_print(dust.compileFn(code, name));
            if (model !== UNDEFINED) {
              _print('------RENDERED------');
              dust.render(name, model, function(err, out) {
                if (err) {
                  throw err;
                } else {
                  _print(out);
                }
              });
            }
        } catch(e) {
          _print('------ERROR------');
          _print('An error occurred rendering ' + name);
          _print(e);
        }
      }
      function _onclick_run(e) {
        _test('basic', 'Hello {name}!', {name: 'Fred'});
        _test('basic', 'Hello {name|s}!', {name: '<em>Fred</em>'});
        _test('basic', 'Hello {name|h}!', {name: '<em>Fred</em>'});
        _test('basic', 'Hello {name|j}!', {name: '"Fred"'});
        _test('basic', 'Hello {name|u}!', {name: 'Fred Smith'});
        _test('basic', 'Hello {name|uc}!', {name: 'Fred/Smith'});
        _test('basic', 'Hello {name|s|h|u}!', {name: '<em>Fred Smith</em>'});
        _test('basic', '\
{#friends}\
    {name}, {age}{~n}\
{/friends}', {friends: [{name: 'Moe', age: 37}, {name: 'Larry', age: 39}, {name: 'Curly', age: 35}]});
        _test('basic', '\
{#friends}\
    {name}, {age}{~n}\
{:else}\
    You have no friends!\
{/friends}', {friends: [{name: 'Moe', age: 37}, {name: 'Larry', age: 39}, {name: 'Curly', age: 35}]});
        _test('basic', '\
{#friends}\
    {name}, {age}{~n}\
{:else}\
    You have no friends!\
{/friends}', {friends: []});
        _test('basic', '\
{#friends/}', {friends: []});
        _test('basic', '\
{#names}{.} {/names}', {names: ['Moe', 'Larry', 'Curly']});
        _test('basic', '\
{foo.bar}', {foo: {bar: 'It worked' }});
        _test('basic', '\
{.foo}', {foo: 'It worked'});
        _test('basic', '\
{#profile bar="baz" bing="bong"}\
    {name}, {bar}, {bing}\
{/profile}', {profile: {name: 'Fred'}});
        _test('basic', '\
{name}{~n}\
{#profile root_name=name}\
  {name}, {root_name}\
{/profile}', {name: 'Foo', profile: {name: 'Bar'}});
        _test('basic', '\
{#snippet id="{name}_id"}\
  {id}\
{/snippet}', {name: 'Fred', snippet: [1, 2, 3]});
        _test('basic', '\
{?tags}\
  <ul class="{foo}">\
    {#tags}\
      <li>{.}</li>\
    {/tags}\
  </ul>\
{:else}\
  No tags!\
{/tags}', {foo: 'bar', tags: ['a', 'b', 'c']});
        _test('basic', '\
{#names}{.}{@idx}{.}{/idx}{@sep}, {/sep}{/names}\
', {names: ['Moe', 'Larry', 'Curly']});
        _test('basic', '\
{#list:projects}{name}{@sep}, {/sep}{/list}\
', {list: [1, 2, 3, 4, 5], projects: [{name: 'alpha'}, {name: 'beta'}, {name: 'omega'}]});
        _test('basic', '\
Hello{~n}World!\
', {});
        _test('basic', '\
{!\
  Multiline\
  {#foo}{bar}{/foo}\
!}\
{!before!}Hello{!after!}\
', {});
        _test('example', '\
Start{~n}\
{+title}\
  Base Title\
{/title}\
{~n}\
{+main}\
  Base Content\
{/main}\
{~n}\
End\
', {});
        _test('profile', '\
Start{~n}\
{+title}\
  {name}, {role}\
{/title}\
Middle{~n}\
{+main}\
  {#degrees}{.}{@sep},{/sep}{/degrees}\
{/main}\
End\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{>profile/}\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{>profile:user/}\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{>profile/}\
{<title}\
  Hey there {name}!\
{/title}\
{<main}\
  I know you have all these fancy degrees, so hopefully\
  they make you a good {role}.\
{/main}\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{+block/}\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{>"~/templates/external.dust.html"/}\
', {name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS'], user: {name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}});
        _test('example', '\
{#employees}\
  {>"~/templates/{type}.dust.html"/}\
{/employees}\
', {employees: [{type: 'foo', name: 'John Doe', role: 'CEO', degrees: ['MBA', 'PMP', 'BS']}, {type: 'bar', name: 'Jane Doe', role: 'CMO', degrees: ['BFA']}]});
        _test('example', '\
Can you see me? {no}\
', {yes: 'Yes'});
        return false;
      }
      document.getElementById('run-tests').onclick = _onclick_run;
    })(xdust);
    </script>
  </body>
</html>